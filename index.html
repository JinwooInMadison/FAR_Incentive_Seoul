<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>ì„œìš¸ì‹œ ìš©ì ë¥  ì¸ì„¼í‹°ë¸Œ ì§€ë„</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: 'Malgun Gothic', sans-serif; }
        #map { width: 100%; height: 100vh; position: relative; z-index: 0; }
        .search-container {
            position: absolute; top: 20px; left: 20px; z-index: 100;
            background: white; padding: 10px; border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); display: flex; gap: 5px;
        }
        #address-input { width: 250px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; outline: none; }
        #search-btn { padding: 8px 15px; background: #ff5722; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        #openLawBtn {
            position: absolute; top: 20px; right: 20px; z-index: 100;
            padding: 12px 20px; background-color: #2c3e50; color: white; 
            border: none; border-radius: 8px; cursor: pointer; font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .modal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); }
        .modal-content { background-color: #f4f7f6; margin: 3% auto; padding: 0; width: 90%; max-width: 800px; border-radius: 12px; box-shadow: 0 5px 30px rgba(0,0,0,0.3); position: relative; }
        .modal-header { background-color: #2c3e50; padding: 15px 25px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .close-btn { color: #fff; font-size: 30px; font-weight: bold; cursor: pointer; }
        .modal-body { padding: 25px; max-height: 70vh; overflow-y: auto; color: #333; line-height: 1.6; }
        .law-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; background: #fff; text-align: center; }
        .law-table th, .law-table td { border: 1px solid #e0e0e0; padding: 10px; font-size: 13px; }
        .highlight-box { background-color: #fff3cd; border: 1px solid #ffeeba; padding: 12px; border-radius: 6px; color: #856404; font-size: 14px; }
        .info-box { padding: 10px; min-width: 220px; line-height: 1.5; font-size: 13px; }
        .info-title { font-weight: bold; color: #ff5722; margin-bottom: 5px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .badge { display: inline-block; background: #e74c3c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-top: 5px; }
    </style>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=105hwwmu52&submodules=geocoder,cadastral"></script>
</head>
<body>

    <div class="search-container">
        <input type="text" id="address-input" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: íš¨ì œë™ 69-4)">
        <button id="search-btn">ê²€ìƒ‰</button>
    </div>

    <button id="openLawBtn">ë²•ë ¹ ë° ì¸ì„¼í‹°ë¸Œ í™•ì¸</button>

    <div id="map"></div>

    <div id="lawModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0; color: #fff; font-size: 18px;">ì„œìš¸íŠ¹ë³„ì‹œ ë„ì‹œê³„íš ì¡°ë¡€ ë° ì¸ì„¼í‹°ë¸Œ</h2>
                <span class="close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <h3 style="font-size: 16px; border-left: 5px solid #3498db; padding-left: 10px;">1. ê±´ì¶• ê·œì œ ì™„í™” (íŠ¹í™”êµ¬ì—­ ê³µí†µ)</h3>
                <table class="law-table">
                    <tr><th>ì™„í™” í•­ëª©</th><th>ì™„í™” ë²”ìœ„</th></tr>
                    <tr><td>ê±´íìœ¨</td><td>êµ­í† ê³„íšë²• ì‹œí–‰ë ¹ ìƒí•œì„  ì´ë‚´</td></tr>
                    <tr><td>ë†’ì´</td><td>ì§€êµ¬ë‹¨ìœ„ê³„íš ìµœê³ ë†’ì´ì˜ 1.3ë°°</td></tr>
                    <tr><td>ìµœëŒ€ê°œë°œê·œëª¨</td><td>ë¯¸ì ìš© (ëŒ€ê·œëª¨ í•©í•„ ê°€ëŠ¥)</td></tr>
                </table>
                <div class="highlight-box">ğŸ’¡ <b>ëª¨í…” ì „í™˜ íŠ¹ë¡€:</b> ê¸°ì¡´ ëª¨í…”ì„ ì „í™˜ ì‹œ ê±´íìœ¨ê³¼ ë†’ì´ <b>ì¤‘ë³µ ì™„í™”</b> ê°€ëŠ¥</div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        var map = null;
        var infoWindow = null;
        var searchMarker = null;
        var vworldKey = "AA847E08-3E79-3FB3-B8EF-FCDDC23BDBEE";

        function initMap() {
            map = new naver.maps.Map('map', {
                center: new naver.maps.LatLng(37.573, 127.002), 
                zoom: 16
            });

            var cadastralLayer = new naver.maps.CadastralLayer();
            cadastralLayer.setMap(map);

            map.data.setStyle(function(feature) {
                return { fillColor: '#ff5722', fillOpacity: 0.20, strokeColor: '#ff5722', strokeWeight: 1.5, clickable: true };
            });

            fetch('./Seoul_Planning_63.geojson')
            .then(res => res.json())
            .then(json => { map.data.addGeoJson(json); })
            .catch(err => console.warn("GeoJSON ë¡œë“œ ì‹¤íŒ¨."));

            infoWindow = new naver.maps.InfoWindow({ content: '', backgroundColor: "#fff", borderColor: "#ff5722", borderWidth: 2 });

            map.data.addListener('click', function(e) {
                var name = e.feature.getProperty('DGM_NM') || "ê´€ê´‘ìˆ™ë°• íŠ¹í™”êµ¬ì—­";
                infoWindow.setContent('<div class="info-box"><div class="info-title">ì§€ì • êµ¬ì—­ ì •ë³´</div>' + name + '</div>');
                infoWindow.open(map, e.coord);
            });

            // ì£¼ì†Œ ê²€ìƒ‰ í•¨ìˆ˜
            window.searchAddress = function() {
                var address = document.getElementById('address-input').value;
                if (!address) return alert('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');

                naver.maps.Service.geocode({ query: address }, function(status, response) {
                    if (status !== naver.maps.Service.Status.OK || response.v2.addresses.length === 0) {
                        return alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    }

                    var item = response.v2.addresses[0];
                    var coords = new naver.maps.LatLng(item.y, item.x);

                    var vworldUrl = "https://api.vworld.kr/req/data?service=data&request=GetFeature&data=LT_C_UQ111&key=" + vworldKey + "&geomFilter=POINT(" + item.x + " " + item.y + ")&crs=EPSG:4326";

                    fetch(vworldUrl)
                    .then(res => res.json())
                    .then(data => {
                        var zoning = "ì¡°íšŒ ì‹¤íŒ¨";
                        var far = "ëŒ€ìƒ êµ¬ì—­ í™•ì¸ í•„ìš”";
                        if(data.response && data.response.status === "OK" && data.response.result) {
                            var props = data.response.result.featureCollection.features[0].properties;
                            zoning = props.unm || "ì •ë³´ ì—†ìŒ";
                            if(zoning.includes("ì¼ë°˜ìƒì—…")) far = "800% â†’ 1,040%";
                        }

                        if (searchMarker) searchMarker.setMap(null);
                        map.setCenter(coords);
                        map.setZoom(18);
                        searchMarker = new naver.maps.Marker({ position: coords, map: map, animation: 2 });

                        infoWindow.setContent('<div class="info-box"><div class="info-title">ê²€ìƒ‰ í•„ì§€ ë¶„ì„</div><b>ì£¼ì†Œ:</b> ' + (item.roadAddress || item.jibunAddress) + '<br><b>ìš©ë„ì§€ì—­:</b> ' + zoning + '<br><div class="badge">' + far + '</div></div>');
                        infoWindow.open(map, coords);
                    });
                });
            };

            document.getElementById('search-btn').onclick = searchAddress;
            document.getElementById('address-input').onkeydown = function(e) { if(e.keyCode === 13) searchAddress(); };
            
            const modal = document.getElementById("lawModal");
            document.getElementById("openLawBtn").onclick = function() { modal.style.display = "block"; };
            document.querySelector(".close-btn").onclick = function() { modal.style.display = "none"; };
        }

        window.onload = initMap;
    </script>
</body>
</html>
