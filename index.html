<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>ì„œìš¸ì‹œ ìš©ì ë¥  ì¸ì„¼í‹°ë¸Œ ì§€ë„</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: 'Malgun Gothic', sans-serif; }
        #map { width: 100%; height: 100vh; position: relative; z-index: 0; }
        
        /* UI ë ˆì´ì•„ì›ƒ */
       .search-container {
            position: absolute; top: 20px; left: 20px; z-index: 100;
            background: white; padding: 10px; border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); display: flex; gap: 5px;
        }
        #address-input { width: 250px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; outline: none; }
        #search-btn { padding: 8px 15px; background: #ff5722; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        #openLawBtn {
            position: absolute; top: 20px; right: 20px; z-index: 100;
            padding: 12px 20px; background-color: #2c3e50; color: white; 
            border: none; border-radius: 8px; cursor: pointer; font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        /* ë²•ë ¹ íŒì—… ìŠ¤íƒ€ì¼ */
       .modal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); }
       .modal-content { background-color: #f4f7f6; margin: 3% auto; padding: 0; width: 90%; max-width: 800px; border-radius: 12px; box-shadow: 0 5px 30px rgba(0,0,0,0.3); position: relative; }
       .modal-header { background-color: #2c3e50; padding: 15px 25px; border-radius: 12px 12px 0 0; display: flex; justify-content: space-between; align-items: center; }
       .close-btn { color: #fff; font-size: 30px; font-weight: bold; cursor: pointer; }
       .modal-body { padding: 25px; max-height: 70vh; overflow-y: auto; color: #333; }
       .law-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; background: #fff; text-align: center; }
       .law-table th,.law-table td { border: 1px solid #e0e0e0; padding: 10px; font-size: 13px; }
       .highlight-box { background-color: #fff3cd; border: 1px solid #ffeeba; padding: 12px; border-radius: 6px; color: #856404; font-size: 14px; margin-bottom: 15px; }

        /* ì •ë³´ì°½ ìŠ¤íƒ€ì¼ */
       .info-box { padding: 10px; min-width: 220px; line-height: 1.6; font-size: 13px; }
       .info-title { font-weight: bold; color: #ff5722; margin-bottom: 5px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
       .badge { display: inline-block; background: #e74c3c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-top: 5px; }
    </style>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=105hwwmu52&submodules=cadastral,geocoder&callback=initMap"></script>
</head>
<body>

    <div class="search-container">
        <input type="text" id="address-input" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: íš¨ì œë™ 69-4)">
        <button id="search-btn">ê²€ìƒ‰</button>
    </div>

    <button id="openLawBtn">ë²•ë ¹ ë° ì¸ì„¼í‹°ë¸Œ í™•ì¸</button>

    <div id="map"></div>

    <div id="lawModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0; color: #fff; font-size: 18px;">ì„œìš¸íŠ¹ë³„ì‹œ ë„ì‹œê³„íš ì¡°ë¡€ ë° ì¸ì„¼í‹°ë¸Œ ë²•ë ¹</h2>
                <span class="close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <h3 style="font-size: 16px; border-left: 5px solid #3498db; padding-left: 10px;">1. ê´€ê´‘ìˆ™ë°• íŠ¹í™”êµ¬ì—­ ë‚´ ê±´ì¶• ê·œì œ ì™„í™”</h3>
                <table class="law-table">
                    <tr><th>ì™„í™” ì‚¬í•­</th><th>ì™„í™” ë²”ìœ„ (ì¸ì„¼í‹°ë¸Œ)</th></tr>
                    <tr><td><b>ê±´íìœ¨</b></td><td>êµ­í† ê³„íšë²• ì‹œí–‰ë ¹ í—ˆìš© ë²”ìœ„ ì´ë‚´</td></tr>
                    <tr><td><b>ë†’ì´</b></td><td>ì§€êµ¬ë‹¨ìœ„ê³„íš ê²°ì • ìµœê³ ë†’ì´ì˜ 1.3ë°°</td></tr>
                    <tr><td><b>ìµœëŒ€ê°œë°œê·œëª¨</b></td><td>ì§€êµ¬ë‹¨ìœ„ê³„íš ê²°ì • ìµœëŒ€ê°œë°œê·œëª¨ ë¯¸ì ìš©</td></tr>
                </table>
                <div class="highlight-box">
                    ğŸ’¡ <b>ëª¨í…” ì „í™˜ íŠ¹ë¡€:</b> ê¸°ì¡´ ëª¨í…”ì„ ê´€ê´‘ìˆ™ë°•ì‹œì„¤ë¡œ ê°œë°œ ì‹œ <b>ê±´íìœ¨ê³¼ ë†’ì´ì˜ ì¤‘ë³µ ì ìš© ê°€ëŠ¥</b> [1, 2]
                </div>

                <h3 style="font-size: 16px; border-left: 5px solid #3498db; padding-left: 10px;">2. ì¡°ë¡€ ì œ51ì¡°ì œ2í•­ì œ1í˜¸ ì‚¬ëª© (ë„ì‹¬ íŠ¹ë¡€)</h3>
                <p style="background:#fff; padding:12px; border:1px solid #ddd; border-radius:6px; font-size:13px; line-height:1.7;">
                    <b>ì„œìš¸ë„ì‹¬ ì§€ì—­</b>ì€ ê¸°ì¡´ ìš©ì ë¥  ê·œì œì—ë„ ë¶ˆêµ¬í•˜ê³ , ë„ì‹¬ ì™¸ ì§€ì—­ ê¸°ì¤€(800%)ì˜ 130%ì¸ <b>ìµœëŒ€ 1,040%</b>ë¥¼ ì ìš©ë°›ìŠµë‹ˆë‹¤. [source: user text]
                </p>

                <p style="text-align: center; color: #e74c3c; font-weight: bold; font-size: 14px; margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 15px;">
                    ğŸ“… ìœ íš¨ê¸°ê°„: 2029ë…„ 1ì›” 4ì¼ ê±´ì¶•í—ˆê°€ ì‹ ì²­ë¶„ê¹Œì§€ 
                </p>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        var map = null;
        var infoWindow = null;
        var searchMarker = null;
        var vworldKey = "AA847E08-3E79-3FB3-B8EF-FCDDC23BDBEE";

        function initMap() {
            // 1. ì§€ë„ ì´ˆê¸°í™”
            map = new naver.maps.Map('map', {
                center: new naver.maps.LatLng(37.573, 127.002), // íš¨ì œë™ ì¸ê·¼ ì¤‘ì‹¬
                zoom: 14
            });

            // 2. ì§€ì í¸ì§‘ë„ ë ˆì´ì–´
            var cadastralLayer = new naver.maps.CadastralLayer();
            cadastralLayer.setMap(map);

            // 3. íŠ¹í™”êµ¬ì—­ ìŠ¤íƒ€ì¼
            map.data.setStyle(function(feature) {
                return { fillColor: '#ff5722', fillOpacity: 0.20, strokeColor: '#ff5722', strokeWeight: 1.5, clickable: true };
            });

            // 4. 63ê°œ êµ¬ì—­ ë°ì´í„° ë¡œë“œ
            fetch('./Seoul_Planning_63.geojson')
             .then(res => res.json())
             .then(json => { map.data.addGeoJson(json); })
             .catch(err => console.warn("GeoJSON ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²½ë¡œë¥¼ í™•ì¸í•˜ì„¸ìš”."));

            infoWindow = new naver.maps.InfoWindow({ content: '', backgroundColor: "#fff", borderColor: "#ff5722", borderWidth: 2 });

            // 5. êµ¬ì—­ í´ë¦­ ì´ë²¤íŠ¸
            map.data.addListener('click', function(e) {
                var name = e.feature.getProperty('DGM_NM') |

| "ê´€ê´‘ìˆ™ë°• íŠ¹í™”êµ¬ì—­";
                infoWindow.setContent('<div class="info-box"><div class="info-title">ì§€ì • êµ¬ì—­ ì •ë³´</div>' + name + '</div>');
                infoWindow.open(map, e.coord);
            });

            // 6. ì£¼ì†Œ ê²€ìƒ‰ ë° ìš©ë„ì§€ì—­ ì¡°íšŒ ê¸°ëŠ¥ (ë°°ì—´ ì¸ë±ìŠ¤ ì˜¤ë¥˜ ìˆ˜ì • ì™„ë£Œ)
            function searchAddress() {
                var address = document.getElementById('address-input').value;
                if (!address) return alert('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');

                naver.maps.Service.geocode({ query: address }, function(status, response) {
                    if (status!== naver.maps.Service.Status.OK |

| response.v2.addresses.length === 0) {
                        return alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    }

                    // [ìˆ˜ì •] ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ì¤‘ ì²« ë²ˆì§¸ í•­ëª©ì„ ëª…í™•íˆ ì§€ì •
                    var item = response.v2.addresses; 
                    var coords = new naver.maps.LatLng(item.y, item.x);

                    // ë¸Œì´ì›”ë“œ APIë¡œ ìš©ë„ì§€ì—­ ì¡°íšŒ
                    var vworldUrl = `https://api.vworld.kr/req/data?service=data&request=GetFeature&data=LT_C_UQ111&key=${vworldKey}&geomFilter=POINT(${item.x} ${item.y})&crs=EPSG:4326`;

                    fetch(vworldUrl)
                     .then(res => res.json())
                     .then(data => {
                            var zoning = "ì¡°íšŒ ì‹¤íŒ¨";
                            var far = "ëŒ€ìƒ êµ¬ì—­ í™•ì¸ í•„ìš”";
                            if(data.response && data.response.status === "OK") {
                                zoning = data.response.result.featureCollection.features.properties.unm;
                                if(zoning.includes("ì¼ë°˜ìƒì—…")) far = "800% â†’ 1,040%";
                                else if(zoning.includes("ê·¼ë¦°ìƒì—…")) far = "600% â†’ 780%";
                            }

                            if (searchMarker) searchMarker.setMap(null);
                            map.setCenter(coords);
                            map.setZoom(18);
                            searchMarker = new naver.maps.Marker({ position: coords, map: map, animation: 2 });

                            infoWindow.setContent(`
                                <div class="info-box">
                                    <div class="info-title">ê²€ìƒ‰ í•„ì§€ ë¶„ì„</div>
                                    <b>ì£¼ì†Œ:</b> ${item.roadAddress |

| item.jibunAddress}<br>
                                    <b>ìš©ë„ì§€ì—­:</b> <span style="color:#2980b9; font-weight:bold;">${zoning}</span><br>
                                    <b>ì˜ˆìƒ ì¸ì„¼í‹°ë¸Œ:</b> <div class="badge">${far}</div>
                                </div>
                            `);
                            infoWindow.open(map, coords);
                        })
                     .catch(err => {
                            console.error("ê³µê°„ì •ë³´ ì¡°íšŒ ì—ëŸ¬", err);
                            if (searchMarker) searchMarker.setMap(null);
                            map.setCenter(coords);
                            searchMarker = new naver.maps.Marker({ position: coords, map: map });
                            infoWindow.setContent('<div class="info-box"><b>ì£¼ì†Œ:</b> ' + (item.roadAddress |

| item.jibunAddress) + '</div>');
                            infoWindow.open(map, coords);
                        });
                });
            }

            document.getElementById('search-btn').onclick = searchAddress;
            document.getElementById('address-input').onkeydown = e => { if(e.keyCode === 13) searchAddress(); };
            
            // íŒì—… ì œì–´
            const modal = document.getElementById("lawModal");
            document.getElementById("openLawBtn").onclick = () => modal.style.display = "block";
            document.querySelector(".close-btn").onclick = () => modal.style.display = "none";
            window.onclick = (e) => { if (e.target == modal) modal.style.display = "none"; }
        }
    </script>
</body>
</html>
